Comments
--------

Preparations:

  >>> portal = layer['portal']
  >>> folder = portal['test-folder']

  >>> from plone.app.testing import login
  >>> from plone.app.testing import TEST_USER_NAME
  >>> login(portal, TEST_USER_NAME)

  >>> _ = folder.invokeFactory('Document', 'doc1')
  >>> from Products.CMFCore.utils import getToolByName
  >>> wftool = getToolByName(portal, 'portal_workflow')
  >>> wftool.doActionFor(folder.doc1, 'publish')

  >>> from Acquisition import aq_get
  >>> addUser = aq_get(portal, 'acl_users').userFolderAddUser
  >>> addUser('member', 'secret', ['Member', 'Reader'], [])

  >>> mtool = getToolByName(portal, 'portal_membership')
  >>> mdata = mtool.getMemberById('member')
  >>> mdata.setMemberProperties(dict(fullname='M\xc3\xa5mb\xc3\xb8r'))

  >>> from plone.app.testing import logout
  >>> logout()

Get us a test browser, logged in as our new user:

  >>> from intranett.policy.tests.base import get_browser
  >>> browser = get_browser(layer, loggedIn=False)
  >>> browser.addHeader('Authorization', 'Basic member:secret')
  >>> browser.handleErrors = False

  >>> browser.open(folder.doc1.absolute_url())
  >>> browser.url
  'http://nohost/plone/test-folder/doc1'

Fill in a comment:

  >>> text = browser.getControl(name='form.widgets.text')
  >>> text.value = 'T\xc3\xa5st http://intranett.no'

  >>> browser.getControl(name='form.buttons.comment').click()

The comment was added and the link turned into a proper clickable one:

  >>> browser.contents
  '...<a href="http://nohost/plone/author/member">M\xc3\xa5mb\xc3\xb8r</a>...
  T&aring;st <a href="http://intranett.no"...>http://intranett.no</a>...'
