Comments
--------

Preparations:

  >>> self.loginAsPortalOwner()
  >>> _ = self.portal.invokeFactory('Document', 'doc1')
  >>> from Products.CMFCore.utils import getToolByName
  >>> wftool = getToolByName(self.portal, 'portal_workflow')
  >>> wftool.doActionFor(self.portal.doc1, 'publish')

  >>> from Acquisition import aq_get
  >>> _doAddUser = aq_get(self.portal, 'acl_users')._doAddUser
  >>> _doAddUser('member', 'secret', ['Member', 'Reader'], [])

  >>> mtool = getToolByName(self.portal, 'portal_membership')
  >>> mdata = mtool.getMemberById('member')
  >>> mdata.setMemberProperties(dict(fullname='M\xc3\xa5mb\xc3\xb8r'))

  >>> self.logout()

Get us a test browser, logged in as our new user:

  >>> browser = self.getBrowser(loggedIn=False)
  >>> browser.addHeader('Authorization', 'Basic member:secret')
  >>> browser.handleErrors = False

  >>> browser.open('http://nohost/plone/doc1')
  >>> browser.url
  'http://nohost/plone/doc1'

Fill in a comment:

  >>> text = browser.getControl(name='form.widgets.text')
  >>> text.value = 'T\xc3\xa5st http://intranett.no'

  >>> browser.getControl(name='form.buttons.comment').click()

The comment was added and the link turned into a proper clickable one:

  >>> browser.contents
  '...<a href="http://nohost/plone/author/member">M\xc3\xa5mb\xc3\xb8r</a>...
  T&aring;st <a href="http://intranett.no"...>http://intranett.no</a>...'
