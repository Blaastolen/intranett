# Generated by buildout based on templates/jarn.conf

upstream backends {
        server localhost:8080;
}

server {
        listen ${nginx-conf:ip-address}:80;

        rewrite ^(.*)$ https://${nginx-conf:domain}$1 permanent;
}

server {
        listen ${nginx-conf:ip-address}:443;

        ssl on;
        ssl_certificate /etc/ssl/STAR_intranett_no.crt;
        ssl_certificate_key /etc/ssl/STAR_intranett_no.key;

        client_max_body_size 10m;
        server_name ${nginx-conf:domain};
        access_log /var/log/nginx/${nginx-conf:domain}_access.log;

        error_page 500 502 503 504  /500.html;

        location /500.html {
                root /srv/jarn/nginx-sites/errors;
        }

        location /under_construction.jpg {
                root /srv/jarn/nginx-sites/errors;
        }

        location / {
                proxy_pass http://backends/VirtualHostBase/https/${nginx-conf:domain}:443/Plone/VirtualHostRoot/;
        }
}
