[buildout]
extends =
    production.cfg
    cfgs/ejabberd.cfg
    cfgs/jarn.cfg

parts +=
    ${buildout:ejabberd-parts}
    convert-template

develop =
    src/intranett.policy
    src/intranett.theme
    src/intranett.tour
    src/jarn.extranet
    src/Products.Extropy
    src/Products.Invoice

[ejabberd]
erlang-path = /usr/bin

[ejabberd-conf]
xmppdomain = localhost

[supervisor-conf]
input = ${buildout:directory}/templates/supervisord-jarn.conf

[instance-base]
eggs +=
    psycopg2
    pylibmc
zeo-client = False
zeo-address =
zeo-realm =
blob-storage =
shared-blob = off
zeo-username =
zeo-password =
rel-storage =
    type postgresql
    dsn dbname='db1' user='zodbuser' host='database01.intranett.no' password='KCn25qUDfRoO}aVn'
    shared-blob-dir false
    blob-dir ${buildout:directory}/var/blobcache
    blob-cache-size 512mb
    poll-interval 60
    cache-local-mb 0
    cache-prefix db1
    cache-servers 127.0.0.1:11211

[convert-template]
recipe = collective.recipe.template
input = inline:
    <filestorage source>
        path ${buildout:directory}/var/filestorage/Data.fs
        blob-dir ${buildout:directory}/var/blobstorage
    </filestorage>
    <relstorage destination>
        shared-blob-dir false
        blob-dir ${buildout:directory}/var/blobcache/db1
        blob-cache-size 10mb
        <postgresql>
            dsn dbname='db1' user='zodbuser' host='localhost' password='KCn25qUDfRoO}aVn'
        </postgresql>
    </relstorage>
output = ${buildout:directory}/convert.conf
