(function(a){a.createReplyForm=function(b){var c=b.attr("id");var e=b.find(".reply-to-comment-button");var d=a("#commenting").clone(true);d.find("#formfield-form-widgets-captcha").find("script").remove();d.appendTo(b).css("display","none");d.removeAttr("id");a(e).css("display","none");var g=d.find("form");g.find("input[name='form.widgets.in_reply_to']").val(c);var f=d.find(".cancelreplytocomment");f.attr("id",c);g.find("input[name='form.buttons.cancel']").css("display","inline");d.slideDown("slow");f.css("display","inline")};a.clearForm=function(b){b.find(".error").removeClass("error");b.find(".fieldErrorBox").remove();b.find("input[type='text']").attr("value","");b.find("textarea").attr("value","")};a(window).load(function(){var c=a("#commenting");var e=c.find("input[name='form.widgets.in_reply_to']");if(e.val()!==""){var b="#"+e.val();var d=a(".discussion").find(b);a.createReplyForm(d);a.clearForm(c)}a(".reply-to-comment-button").bind("click",function(g){var f=a(this).parents().filter(".comment");a.createReplyForm(f);a.clearForm(f)});a("#commenting #form-buttons-cancel").bind("click",function(g){g.preventDefault();var f=a(this).parents().filter(".comment").find(".reply-to-comment-button");a.reply_to_comment_form=a(this).parents().filter(".reply");a.reply_to_comment_form.slideUp("slow",function(){a(this).remove()});f.css("display","inline")});a("input[name='form.button.PublishComment']").live("click",function(){var f=this;var g=a(this).parents("form");var h=a(g).serialize();var i=a(g).attr("action");a.ajax({type:"GET",url:i,data:"workflow_action=publish",context:f,success:function(j){g.find("input[name='form.button.PublishComment']").remove();g.parents(".state-pending").toggleClass("state-pending").toggleClass("state-published")},error:function(j){return true}});return false});a("input[name='form.button.DeleteComment']").live("click",function(){var f=this;var g=a(this).parents("form");var h=a(g).serialize();var i=a(g).attr("action");a.ajax({type:"POST",url:i,context:a(f).parents(".comment"),success:function(m){if(a(".discussion .replyTreeLevel0").length===1){a(".discussion").fadeOut("fast",function(){a(".discussion").remove()})}else{var o=a(this);var k=o.attr("class");var n=parseInt(k[k.indexOf("replyTreeLevel")+"replyTreeLevel".length],10);var j=".replyTreeLevel"+n;for(var l=0;l<n;l++){j+=", .replyTreeLevel"+l}o.nextUntil(j).each(function(){a(this).fadeOut("fast",function(){a(this).remove()})});a(this).fadeOut("fast",function(){a(this).remove()})}},error:function(k,j){return true}});return false});a(".reply").find("input[name='form.buttons.reply']").css("display","none");a(".reply").find("input[name='form.buttons.cancel']").css("display","none");a(".reply-to-comment-button").css("display","inline")})}(jQuery));