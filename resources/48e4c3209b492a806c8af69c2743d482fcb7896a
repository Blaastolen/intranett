if(!window.beforeunload){(function(e){var b,a,d,f;b=function(){var c=this,g;this.message=window.form_modified_message||"Discard changes? If you click OK, any changes you have made will be lost.";this.forms=[];this.chkId=[];this.chkType=new this.CheckType();this.handlers=[this.isAnyFormChanged];this.submitting=false;this.execute=function(i){var h=e("form");c.forms=e.grep(c.forms,function(j){return h.index(j)>-1});if(c.submitting){return}e.each(c.handlers,function(j,k){g=g||k.apply(c)});if(g===true){g=c.message}if(g===false){g=undefined}if(i&&g){i.returnValue=g}return g};this.execute.tool=this};a=b.prototype;a.isAnyFormChanged=function(){var c;for(c=0;c<this.forms.length;c+=1){d=this.forms[c];if(this.isElementChanged(d)){return true}}return false};a.addHandler=function(c){this.handlers.push(c)};a.onsubmit=function(){var c=window.onbeforeunload&&window.onbeforeunload.tool;c.submitting=true;plone.UnlockHandler.submitting=true};a.addForm=function(c){if(e.inArray(c,this.forms)>-1){return}this.forms.push(c);e(c).submit(this.onsubmit);e(c).find("input:hidden").each(function(){var g=this.defaultValue;if(g!==undefined&&g!==null){e(this).attr("originalValue",g.replace(/\r\n?/g,"\n"))}})};a.addForms=function(){var c=this;e.each(arguments,function(){if(this.tagName.toLowerCase()==="form"){c.addForm(this)}else{c.addForms.apply(c,e(this).find("form").get())}})};a.removeForms=function(){var c=this;e.each(arguments,function(){if(this.tagName.toLowerCase()==="form"){var g=this;c.forms=e.grep(c.forms,function(h){return h!==g});e(g).unbind("submit",c.onsubmit)}else{c.removeForms.apply(c,e(this).find("form").get())}})};a.CheckType=function(){};f=a.CheckType.prototype;f.checkbox=f.radio=function(c){return c.checked!==c.defaultChecked};f.file=f.password=f.textarea=f.text=function(c){return c.value!==c.defaultValue};f.hidden=function(c){var g=e(c).attr("originalValue");if(g===undefined||g===null){return false}return e(c).val().replace(/\r\n?/g,"\n")!==g};f["select-one"]=function(h){var g,c;for(g=0;g<h.length;g+=1){c=h[g];if(c.selected!==c.defaultSelected){if(g===0&&c.selected){continue}return true}}return false};f["select-multiple"]=function(h){var g,c;for(g=0;g<h.length;g+=1){c=h[g];if(c.selected!==c.defaultSelected){return true}}return false};a.chk_form=function(h){var c=e(h).find("> :input:not(.noUnloadProtection),:not(.noUnloadProtection) :input:not(.noUnloadProtection)"),g;for(g=0;g<c.length;g+=1){if(this.isElementChanged(c.get(g))){return true}}return false};a.isElementChanged=function(c){var g=c.id&&this.chkId[c.id];if(!g&&c.type&&c.name){g=this.chkType[c.type]}if(!g&&c.tagName){g=this["chk_"+c.tagName.toLowerCase()]}return g?g.call(this,c):false};window.onbeforeunload=new b().execute;e(function(){var c=window.onbeforeunload&&window.onbeforeunload.tool;if(c&&e("#region-content,#content").length){c.addForms.apply(c,e("form.enableUnloadProtection").get())}})}(jQuery))};