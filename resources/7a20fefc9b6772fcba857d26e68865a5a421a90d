if(typeof(plone)==="undefined"){var plone={}}(function(a){plone.jscalendar={_calendar:null,_current_input:null,_field_names:["year","month","day","hour","minute","ampm"],_fields:function(c){if(c===undefined){c=plone.jscalendar._current_input}var b={field:a(c)};a.each(plone.jscalendar._field_names,function(){b[this]=a(c+"_"+this)});return b},init:function(){a(".plone_jscalendar > input:hidden").each(function(){var b="#"+this.id;a.each(plone.jscalendar._fields(b),function(){this.filter("select").bind("change.plone.jscalendar",{selector:b},plone.jscalendar.update_hidden)})})},show:function(e,c,f){var g=plone.jscalendar._cal,b,d;if(!g){g=plone.jscalendar._cal=new Calendar(1,null,plone.jscalendar.handle_select,plone.jscalendar.handle_close);g.create()}else{g.hide()}plone.jscalendar._current_input=e;b=plone.jscalendar._fields();d=b.month;g.setRange(c,f);if(b.year.val()>0){g.date.setFullYear(b.year.val())}if(b.month.val()>0){g.date.setMonth(b.month.val()-1)}if(b.day.val()>0){g.date.setDate(b.day.val())}g.refresh();g.showAtElement(d.get(0),null);return false},handle_select:function(f,d){var b=plone.jscalendar._fields(),g=d.substring(0,4),c,e;if(a.nodeName(b.year.get(0),"select")&&!b.year.children("option[value="+g+"]").length){c=b.year.get(0).options;for(e=c.length;e>0;e=e-1){if(c[e].value>g){c[e+1]=new Option(c[e].value,c[e].text)}else{c[e+1]=new Option(g,g);break}}}b.year.val(g);b.month.val(d.substring(5,7));b.day.val(d.substring(8,10));plone.jscalendar.update_hidden()},handle_close:function(b){b.hide()},update_hidden:function(h){var i="",g=plone.jscalendar._fields(h&&h.data.selector),d,c,b;if(h&&h.target.selectedIndex===0){d=h.target.id.substr(h.data.selector.length);c=a.inArray(d,["hour","minute","ampm"])>-1?"select[id$=hour],select[id$=minute],select[id$=ampm]":"select";a.each(g,function(){this.filter(c).attr("selectedIndex",0)})}else{if(g.year.val()>0&&g.month.val()>0&&g.day.val()>0){i=[g.year.val(),g.month.val(),g.day.val()].join("-");b=new Date(i.replace(/-/g,"/"));if(b.print("%Y-%m-%d")!==i){i=b.print("%Y-%m-%d");g.year.val(i.substring(0,4));g.month.val(i.substring(5,7));g.day.val(i.substring(8,10))}if(g.hour.length&&g.minute.length){i+=" "+[g.hour.val(),g.minute.val()].join(":");if(g.ampm.length){i+=" "+g.ampm.val()}}}}g.field.val(i)}}}(jQuery));jQuery(function(a){a(plone.jscalendar.init);a(".plone-jscalendar-popup").each(function(){var d=a(this),c=this.id.replace("_popup",""),b=a("#"+c+"_yearStart").val(),e=a("#"+c+"_yearEnd").val();if(b&&e){d.css("cursor","pointer").show().click(function(f){return plone.jscalendar.show("#"+c,b,e)})}})});