var ploneDnDReorder={};ploneDnDReorder.dragging=null;ploneDnDReorder.table=null;ploneDnDReorder.rows=null;ploneDnDReorder.locked=false;(function(a){ploneDnDReorder.doDown=function(d){var c=ploneDnDReorder.dragging,b;if(ploneDnDReorder.locked){return}if(c){if(a(this).attr("id")!==c.attr("id")){ploneDnDReorder.locked=true;c.removeClass("dragging").addClass("error")}return}c=a(this).parents(".draggable:first");if(!c.length){return}ploneDnDReorder.rows.mousemove(ploneDnDReorder.doDrag);b=a("body");b.mouseup(ploneDnDReorder.doUp);b.mouseleave(ploneDnDReorder.doCancel);ploneDnDReorder.dragging=c;c.data("ploneDnDReorder.startPosition",ploneDnDReorder.getPos(c));c.addClass("dragging");a(this).parents("tr").addClass("dragindicator");c.data("ploneDnDReorder.subset_ids",a.map(ploneDnDReorder.table.find("tr.draggable"),function(e){return a(e).attr("id").substr("folder-contents-item-".length)}));return false};ploneDnDReorder.getPos=function(b){var c=b.parent().children(".draggable").index(b[0]);return c===-1?null:c};ploneDnDReorder.doDrag=function(d){var b=ploneDnDReorder.dragging,c=this;if(!b){return}if(!c){return}if(a(c).attr("id")!==b.attr("id")){ploneDnDReorder.swapElements(a(c),b)}return false};ploneDnDReorder.swapElements=function(f,e){var d=f.parent(),b=d.children("[id]"),c;if(Math.abs(ploneDnDReorder.getPos(f)-ploneDnDReorder.getPos(e))!==1){return}b.removeClass("even").removeClass("odd");if(f[0].swapNode){f[0].swapNode(e[0])}else{c=d[0].insertBefore(document.createTextNode(""),f[0]);f.insertBefore(e);e.insertBefore(c);a(c).remove()}d.children("[id]:odd").addClass("even");d.children("[id]:even").addClass("odd")};ploneDnDReorder.doUp=function(d){var c=ploneDnDReorder.dragging,b=a("body");if(!c){return}ploneDnDReorder.updatePositionOnServer();c.removeData("ploneDnDReorder.startPosition");c.removeData("ploneDnDReorder.subset_ids");ploneDnDReorder.rows.unbind("mousemove",ploneDnDReorder.doDrag);b.unbind("mouseup",ploneDnDReorder.doUp);b.unbind("mouseleave",ploneDnDReorder.doCancel);a(this).parents("tr").removeClass("dragindicator");return false};ploneDnDReorder.doCancel=function(d){var c=ploneDnDReorder.dragging,b=a("body");if(!c){return}c.removeClass("dragging");if(ploneDnDReorder.getPos(c)-c.data("ploneDnDReorder.startPosition")){ploneDnDReorder.locked=true;c.addClass("error")}ploneDnDReorder.rows.unbind("mousemove",ploneDnDReorder.doDrag);b.unbind("mouseup",ploneDnDReorder.doCancel);b.unbind("mouseleave",ploneDnDReorder.doCancel);ploneDnDReorder.dragging=null;return false};ploneDnDReorder.updatePositionOnServer=function(){var c=ploneDnDReorder.dragging,e,b,d;if(!c){return}e=ploneDnDReorder.getPos(c)-c.data("ploneDnDReorder.startPosition");if(e===0){return}b={item_id:c.attr("id").substr("folder-contents-item-".length),subset_ids:c.data("ploneDnDReorder.subset_ids")};b["delta:int"]=e;d=a.param(b).replace(/%5B%5D=/g,"%3Alist=");a.ajax({type:"POST",url:"folder_moveitem",data:d,complete:ploneDnDReorder.complete});ploneDnDReorder.locked=true};ploneDnDReorder.complete=function(c,d){var b=ploneDnDReorder.dragging;b.removeClass("dragging");if(d==="success"||d==="notmodified"){ploneDnDReorder.locked=false}else{b.addClass("error")}ploneDnDReorder.dragging=null}}(jQuery));