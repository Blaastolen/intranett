var ploneFormTabbing={jqtConfig:{current:"selected"}};(function(a){ploneFormTabbing._buildTabs=function(b,g){var f=g.length>6;var j,e=[],l="";for(var d=0;d<g.length;d++){var k,c,m=g[d],h=m.id;e[d]="#"+h;switch(d){case (0):k='class="formTab firstFormTab"';break;case (g.length-1):k='class="formTab lastFormTab"';break;default:k='class="formTab"';break}if(f){c="<option "+k+' id="'+h+'" value="'+h+'">';c+=a(m).text()+"</option>"}else{c="<li "+k+'><a id="'+h+'" href="#'+h+'"><span>';c+=a(m).text()+"</span></a></li>"}l+=c;a(m).hide()}e=e.join(",");j=e.replace(/#fieldsetlegend-/g,"#fieldset-");if(f){l=a('<select class="formTabs">'+l+"</select>");l.change(function(){var i=a(this).attr("value");jq("#"+i).click()})}else{l=a('<ul class="formTabs">'+l+"</ul>")}return l};ploneFormTabbing.initializeDL=function(){var b=a(ploneFormTabbing._buildTabs(this,a(this).children("dt")));var c=a(this).children("dd");a(this).before(b);c.addClass("formPanel");b.tabs(c,ploneFormTabbing.jqtConfig)};ploneFormTabbing.initializeForm=function(){var e=a(this);var d=e.children("fieldset");if(!d.length){return}var b=ploneFormTabbing._buildTabs(this,d.children("legend"));a(this).prepend(b);d.addClass("formPanel");a(this).find('input[name="fieldset.current"]').addClass("noUnloadProtection");a(this).find(".formPanel:has(div.field span.required)").each(function(){var j=this.id.replace(/^fieldset-/,"#fieldsetlegend-");a(j).addClass("required")});var h=0;var f=0;var g=false;a(this).find(".formPanel").each(function(){if(!g&&a(this).find("div.field.error").length!=0){h=f;g=true}f+=1});var c="ul.formTabs";if(a(b).is("select.formTabs")){c="select.formTabs"}var i=a.extend({},ploneFormTabbing.jqtConfig,{initialIndex:h});e.children(c).tabs("form.enableFormTabbing fieldset.formPanel",i);e.submit(function(){var j;if(b.find("a.selected").length>=1){j=b.find("a.selected").attr("href").replace(/^#fieldsetlegend-/,"#fieldset-")}else{j=b.attr("value").replace(/^fieldsetlegend-/,"#fieldset-")}var k=e.find('input[name="fieldset.current"]');if(j&&k){k.val(j)}});a("#archetypes-schemata-links").addClass("hiddenStructure");a("div.formControls input[name='form.button.previous'],div.formControls input[name='form.button.next']").remove()};a.fn.ploneTabInit=function(b){return this.each(function(){var d=a(this);d.find("form.enableFormTabbing,div.enableFormTabbing").each(ploneFormTabbing.initializeForm);d.find("dl.enableFormTabbing").each(ploneFormTabbing.initializeDL);var c=d.find('.enableFormTabbing input[name="fieldset.current"]').val()||window.location.hash;if(c){d.find(".enableFormTabbing .formTab a[href='"+c.replace("'","").replace(/^#fieldset-/,"#fieldsetlegend-")+"']").click()}})};ploneFormTabbing.initialize=function(){a("body").ploneTabInit()}})(jQuery);jQuery(function(){ploneFormTabbing.initialize()});