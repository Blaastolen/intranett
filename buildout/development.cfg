[buildout]
extends =
    buildout.cfg

parts =
    instance
    zeo
    zopepy
    omelette
    test
    ohcount
    coverage
    report

[instance]
verbose-security = on
http-address = 8080

[omelette]
recipe = collective.recipe.omelette
eggs = ${instance:eggs}

[test]
recipe = collective.xmltestreport
eggs = ${instance:eggs}
defaults = ['--auto-color', '--auto-progress', '-q', '--module', '^jarn[.]']

[ohcount]
recipe = zc.recipe.egg
eggs = ohconvert

[coverage]
recipe = zc.recipe.egg
eggs = coverage
initialization =
    sys.argv = sys.argv[:] + ['run', 'bin/test', '--all', '-k', '--xml']

[report]
recipe = zc.recipe.egg
eggs = coverage
scripts = coverage=report
initialization =
    eggs = '${buildout:eggs-directory}'
    bin = '${buildout:directory}/bin'
    exclude = '--omit=' + ','.join([eggs, sys.prefix, bin])
    sys.argv = sys.argv[:] + ['xml', '-i', exclude]
