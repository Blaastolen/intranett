[buildout]
extends =
    development.cfg
    cfgs/jarn.cfg
    cfgs/ejabberd.cfg

parts +=
    nginx
    frontend
    supervisor
    supervisor-conf
    ${buildout:ejabberd-parts}

auto-checkout +=
    jarn.extranet
    Products.Extropy
    Products.Invoice

[ejabberd]
erlang-path = /opt/local/bin

[ejabberd.cfg]
xmppdomain = localhost

[instance]
http-address = 8081

[nginx]
recipe = gocept.cmmi
url = http://sysoev.ru/nginx/nginx-0.5.30.tar.gz
md5sum = 804cf3d6583fe820de42c5e7c50d7a1a

[frontend]
recipe = gocept.nginx
configuration =
  worker_processes 1;
  daemon off;
  events {
    worker_connections 1024;
  }
  http {
    server {
        listen       8080;
        server_name  localhost;

        location ~ ^/http-bind/ {
            proxy_pass http://localhost:5280;
        }

        location / {
            proxy_pass http://localhost:8081/VirtualHostBase/http/localhost:8080/Plone/VirtualHostRoot/;
        }

    }
  }

[supervisor]
recipe = zc.recipe.egg
eggs = supervisor

[supervisor]
recipe = zc.recipe.egg
eggs = supervisor

[supervisor-conf]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/supervisord-dev.conf
output = ${buildout:directory}/etc/supervisord.conf
