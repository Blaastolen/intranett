<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      i18n:domain="extropy"
      metal:use-macro="here/main_template/macros/master">

<head></head>

<body>

<div metal:fill-slot="main">

    <h1 tal:content="context/Title" />

    <div class="visualClear"><!----></div>

    <div tal:define="worked here/getWorkedHours;
                     URL here/absolute_url;
                     bar nocall:context/@@progressbar">
        <a tal:replace="structure python:bar(URL=URL, worked=worked)"></a>
    </div>

    <p style="text-align: right">
        <a tal:attributes="href string:${here/absolute_url}/add_work_hours">
        <img tal:replace="structure here/hour_icon.gif" />Register work hours</a>
    </p>

    <dl id="parentdata" class="collapsible collapsedOnLoad"
        tal:define="deliverable here/getOriginatingFeature">
        <dt class="collapsibleHeader">Parent deliverable &quot;<span tal:replace="deliverable/Title"></span>&quot;</dt>
        <dd class="collapsibleContent"><p tal:replace="structure deliverable/getText"></p></dd>
        <dd class="collapsibleContent">
            <table class="vertical listing">
                <tr>
                    <th>Sibling tasks</th>
                    <td tal:define="deliverable here/getOriginatingFeature;
                                    etool nocall:here/extropy_tracking_tool;
                                    tasks python:etool.trackingQuery(deliverable, meta_type='ExtropyTask', REQUEST=request);">
                        <div tal:repeat="task tasks">
                            <a tal:attributes="href task/getURL;
                                               class string:state-${task/review_state};"
                               tal:content="task/Title">
                                Task
                            </a>
                        </div>
                    </td>
                </tr>
            </table>
        </dd>
    </dl>

    <h2>Status</h2>

    <table class="vertical listing" style="float: right; margin: 1em">
        <tbody tal:define="mtool nocall:context/portal_membership;">
            <tr>
                <th>Priority</th>
                <td>
                    <span tal:content="here/getPriorityDescription">Urgent</span>
                </td>
            </tr>
            <tr>
                <th>Active after</th>
                <td>
                    <span tal:condition="here/start"
                          tal:content="python:here.start().strftime('%d %b')"></span>
                </td>
            </tr>
            <tr>
                <th>Due Date</th>
                <td>
                    <span tal:condition="here/end"
                          tal:content="python:here.end().strftime('%d %b')"></span>
                </td>
            </tr>
            <tr>
                <th>Responsible</th>
                <td>
                    <span tal:define="responsible here/getResponsiblePerson;
                                      author python:responsible and mtool.getMemberInfo(responsible)"
                          tal:content="author/fullname|responsible"
                          >limi</span>
                </td>
            </tr>
            <tr>
                <th>Nosy list</th>
                <td>
                    <tal:participants repeat="participant here/getParticipants">
                        <span tal:define="author python:mtool.getMemberInfo(participant);
                                          name author/fullname|participant"
                              tal:replace="name">limi</span><span
                              tal:condition="not:repeat/participant/end"
                              tal:omit-tag="">,</span>
                    </tal:participants>
                </td>
            </tr>
        </tbody>
    </table>

    <metal:field use-macro="python:context.widget('text', mode='view')">
        Body text
    </metal:field>

    <div class="visualClear"><!----></div>

    <div metal:use-macro="here/extropyproject_view/macros/contentlisting"></div>

</div>
</body>
</html>
