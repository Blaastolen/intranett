<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      i18n:domain="extropy"
      metal:use-macro="here/main_template/macros/master">
  <head>
  </head>
<body>

<div metal:fill-slot="main"
     tal:define="etool nocall:here/extropy_tracking_tool;">

<div tal:define="projects python:etool.searchResults(meta_type='ExtropyProject', review_state=['active', 'closable'], sort_on='getId');
                 projectsbystate python:etool.dictifyBrains(projects, 'review_state').items()">

    <div tal:repeat="state projectsbystate">

        <h3>
            <tal:h tal:condition="python:state[0] == 'active'" tal:content="string:Active projects" />
            <tal:h tal:condition="python:state[0] == 'closable'" tal:content="string:Finished projects waiting for invoicing" />
            <tal:h tal:condition="python:state[0] not in ('active', 'closable')" tal:content="python:state[0]" />
        </h3>

            <dl tal:repeat="phase python:[p.getObject() for p in state[1] if 'Management Project' not in p.Subject and 'Ongoing Project' not in p.Subject]">
                <dt>
                        <a tal:attributes="href phase/absolute_url"><span tal:content="phase/Title" /></a> [<span tal:replace="phase/getProjectManager" />]
                </dt>
                <dd>    
                        <span tal:content="phase/projectStatus | nothing">[status]</span>
                </dd>

            </dl>

            <tal:block tal:define="projects python:[p.getObject() for p in state[1] if 'Ongoing Project' in p.Subject]"
                       tal:condition="projects">

            <h3>Ongoing projects</h3>

            <dl tal:repeat="phase projects">
                <dt>
                        <a tal:attributes="href phase/absolute_url"><span tal:content="phase/Title" /></a> [<span tal:replace="phase/getProjectManager" />]
                </dt>
                <dd>
                        <span tal:content="phase/projectStatus | nothing">[status]</span>
                </dd>
            </dl>

            </tal:block>

            <tal:block tal:define="projects python:[p.getObject() for p in state[1] if 'Management Project' in p.Subject]"
                       tal:condition="projects">

            <h3>Internal projects</h3>

            <dl tal:repeat="phase projects">
                <tal:block tal:condition="python: phase.getId() != 'psol'">
                <dt>
                        <a tal:attributes="href phase/absolute_url"><span tal:content="phase/Title" /></a> [<span tal:replace="phase/getProjectManager" />]
                </dt>
                <dd>
                        <span tal:content="phase/projectStatus | nothing">[status]</span>
                </dd>
                </tal:block>
            </dl>

            </tal:block>

    </div>
</div>

</div>

</body>
</html>
