<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body metal:fill-slot="main"
      tal:define="view context/@@hourreporttable_view;
                  start request/start|nothing;
                  end request/end|nothing;
                  username request/username|nothing;
                  group_by request/group_by|string:getBudgetCategory:Creator;
                  group_by python:group_by and same_type(group_by,'') and group_by.split(':') or group_by;
                  query python:{};
                  dummy python:[query.setdefault(x,request.get(x)) for x in ['review_state','portal_type','getBudgetCategory', 'local'] if request.has_key(x)];
                  results python:view.getReportData(start=start,end=end,username=username,group_by=group_by, **query)">

        <h1>Hour report</h1>
    
        <div class="documentDescription">
            This lists the hours registered
        </div>

        <h2>Links</h2>
        <a tal:attributes="href string:${request/URL0}?group_by=start/month:Creator&amp;getBudgetCategory=Billable">Month:Creator - Billable</a>
        <tal:years repeat="year python:range(2005, DateTime().year() + 1)">
          (<a tal:attributes="href string:${request/URL0}?group_by=start/month:Creator&amp;getBudgetCategory=Billable&amp;start=$year/01/01&amp;end=$year/12/31"
              tal:content="year">Year</a>)
        </tal:years>
        <br/>
        <a tal:attributes="href string:${request/URL0}?group_by=start/month:getBudgetCategory">Month:Budget category</a>
        <br/>
        <a tal:define="now python:DateTime();
                       thismonth python:DateTime('%s/%s/01'%(now.year(), now.month()));
                       lastmonth python:DateTime('%s/%s/01'%((thismonth-1).year(), (thismonth-1).month()));"
           tal:attributes="href string:${request/URL0}?start=${lastmonth/Date}&amp;end=${thismonth/Date}&amp;group_by=Creator:getBudgetCategory">Creator:Budget category - last month</a>
        <br/>
        <a tal:define="now python:DateTime();
                       thismonth python:DateTime('%s/%s/01'%(now.year(), now.month()));"
           tal:attributes="href string:${request/URL0}?start=${thismonth/Date}&amp;group_by=Creator:getBudgetCategory">Creator:Budget category - this month</a>


        <h2>Statistics</h2>

        <table class="listing"
               width="100%"
               metal:define-macro="reportnodenestedtable">
            <thead>
                <td />
                <th tal:repeat="col results/getTableHeaders">
                    <span tal:replace="col" />
                </th>
            </thead>
            <tbody>
                <tr tal:repeat="row results/rows">
                    <td tal:repeat="rh row/rowheader">
                        <span tal:replace="rh">Row header</span>
                    </td>

                    <td tal:repeat="col row">
                        <span tal:replace="col">Value</span>
                    </td>
                </tr>
            </tbody>
        </table>


</body>
</html>

